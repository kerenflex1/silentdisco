<script>
  document.getElementById('contact-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    const form = this;

    // איסוף ו־sanitize של הערכים
    const rawPhone = form.phone.value.replace(/[^0-9]/g, '');
    // אם טלפונים חסרים את ה־0 ההתחלתי, מוסיפים אותו
    const normalizedPhone = rawPhone.length === 9
      ? '0' + rawPhone
      : rawPhone;
    // הגנה מפני Google Sheets שממירה למספר: מוסיפים אפוסטרופ לשליחת טקסט
    const phoneForSheet = '\'' + normalizedPhone;

    const data = {
      name: form.name.value.trim(),
      email: form.email.value.trim(),
      phone: phoneForSheet,
      eventDetails: form.eventDetails.value.trim(),
      eventDate: form.eventDate.value,
      guests: form.guests.value
    };

    // ולידציה
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const phonePattern = /^\d{10}$/;
    if (!emailPattern.test(data.email)) {
      alert('נא להזין כתובת דוא"ל תקינה');
      return;
    }
    if (!phonePattern.test(normalizedPhone)) {
      alert('נא להזין מספר טלפון תקין בן 10 ספרות, כולל 0 בתחילה');
      return;
    }

    try {
      const response = await fetch('https://hook.eu2.make.com/hjgji3rbb6011ueetx1rp7zrgidkfifq', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      if (!response.ok) throw new Error('Network response was not ok');
      form.innerHTML = '<p class="success-message">הטופס נשלח בהצלחה!<br/>מייד ניצור איתכם קשר.</p>';
    } catch (err) {
      console.error(err);
      alert('אירעה שגיאה בשליחת הטופס. אנא נסו שוב מאוחר יותר.');
    }
  });
</script>
